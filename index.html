<!DOCTYPE html>
<html>
<head>
  <title>Chakra Tracker</title>
  <style>
    body {
      font-family: sans-serif;
    }

    #messageArea {
      margin-top: 10px;
      color: red;
    }

    #jutsuItems li {
      cursor: context-menu;
    }

    #inputArea {
      border-bottom: 2px solid black;
      /* Add black bar below input area */
      padding-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>Chakra Tracker</h1>

  <div id="inputArea">
    <div>
      Max Chakra: <input type="number" id="maxChakra" value="10">
      Replenish Rate: <input type="number" id="replenishRate" value="0">
      <button onclick="initializeTracker()">Initialize</button>
    </div>
    <div id="chakraInfo">
      Current Chakra: <span id="currentChakra">0</span>/<span id="maxChakraDisplay">0</span>
    </div>
    <div>
      Jutsu Name: <input type="text" id="jutsuName">
      Chakra Cost: <input type="number" id="jutsuCost">
      <button onclick="addJutsu()">Add Jutsu</button>
    </div>
    <div>
      Jutsu to Use: <input type="text" id="jutsuToUse">
      <button onclick="useJutsu()">Use Jutsu</button>
    </div>
    <div>
      <button onclick="recoverChakra()">Recover Chakra</button>
    </div>
    <div>
      <button onclick="saveData()">Save Data</button>
      <input type="file" id="fileInput" accept=".txt">
      <button onclick="loadData()">Load Data</button>
    </div>
  </div>

  <div id="jutsuList">
    <h2>Available Jutsu:</h2>
    <ul id="jutsuItems"></ul>
  </div>
  <div id="messageArea"></div>

  <script>
    let chakraTracker;
    const messageArea = document.getElementById("messageArea");
    const maxChakraInput = document.getElementById("maxChakra");
    const replenishRateInput = document.getElementById("replenishRate");
    const jutsuNameInput = document.getElementById("jutsuName");
    const jutsuCostInput = document.getElementById("jutsuCost");
    const fileInput = document.getElementById("fileInput");

    function displayMessage(message, isError = true) {
      messageArea.textContent = message;
      messageArea.style.color = isError? "red": "green";
    }

    function initializeTracker() {
      const maxChakra = parseInt(maxChakraInput.value);
      const replenishRate = parseFloat(replenishRateInput.value);

      if (isNaN(maxChakra) || maxChakra <= 0) {
        displayMessage("Invalid Max Chakra.", true);
        return;
      }
      if (isNaN(replenishRate) || replenishRate < 0) {
        displayMessage("Invalid Replenish Rate.", true);
        return;
      }

      chakraTracker = new ChakraTracker(maxChakra, replenishRate);
      updateDisplay();
    }

    class ChakraTracker {
      constructor(maxChakra, replenishRate = 0) {
        this.maxChakra = maxChakra;
        this.replenishRate = replenishRate;
        this.currentChakra = this.maxChakra;
        this.lastReplenishTime = Date.now();
        this.jutsuList = {};
      }

      replenish() {
        const now = Date.now();
        const timeElapsed = Math.floor((now - this.lastReplenishTime) / 1000);

        if (this.replenishRate > 0 && timeElapsed >= 1) {
          const replenishAmount = this.replenishRate * timeElapsed;
          this.currentChakra = Math.min(this.currentChakra + replenishAmount, this.maxChakra);
          this.lastReplenishTime = now;
        }
      }

      useChakra(amount) {
        this.replenish();
        if (amount > 0 && amount <= this.currentChakra) {
          this.currentChakra -= amount;
          return true;
        }
        return false;
      }

      recoverChakra() {
        let amount = parseInt(prompt("Enter amount to recover:"));
        if (!isNaN(amount) && amount > 0) {
          this.replenish();
          this.currentChakra = Math.min(this.currentChakra + amount, this.maxChakra);
          updateDisplay();
        } else {
          alert("Invalid recovery amount.");
        }
      }

      addJutsu() {
        const jutsuName = jutsuNameInput.value;
        const chakraCost = parseInt(jutsuCostInput.value);

        if (!jutsuName || isNaN(chakraCost) || chakraCost <= 0) {
          displayMessage("Invalid jutsu name or chakra cost.", true);
          return;
        }

        this.jutsuList[jutsuName] = chakraCost;
        displayJutsuList(); // Call to update the list in real-time
        saveData();
        jutsuNameInput.value = "";
        jutsuCostInput.value = "";
        displayMessage("Jutsu added successfully!", false);
      }

      useJutsu() {
        const jutsuName = document.getElementById("jutsuToUse").value;
        if (this.jutsuList[jutsuName]) {
          if (this.useChakra(this.jutsuList[jutsuName])) {
            updateDisplay();
            displayMessage(`Used ${jutsuName} for ${this.jutsuList[jutsuName]} chakra.`, false);
          } else {
            displayMessage(`Not enough chakra for ${jutsuName}!`, true);
          }
        } else {
          displayMessage("Jutsu not found.", true);
        }
      }

      removeJutsu(jutsuToRemove) {
        if (this.jutsuList[jutsuToRemove]) {
          delete this.jutsuList[jutsuToRemove];
          displayJutsuList();
          saveData();
          displayMessage("Jutsu removed successfully!", false);
        } else {
          displayMessage("Jutsu not found.", true);
        }
      }

      displayJutsuList() {
        const jutsuListElement = document.getElementById("jutsuItems");
        jutsuListElement.innerHTML = "";

        for (const jutsu in this.jutsuList) {
          const li = document.createElement("li");
          li.textContent = `${jutsu}: ${this.jutsuList[jutsu]} chakra`;
          li.addEventListener('contextmenu', (event) => {
            event.preventDefault();
            if (confirm(`Delete ${jutsu}?`)) {
              chakraTracker.removeJutsu(jutsu);
            }
          });
          jutsuListElement.appendChild(li);
        }
      }
    }

    function saveData() {
      if (chakraTracker) {
        const data = {
          maxChakra: chakraTracker.maxChakra,
          replenishRate: chakraTracker.replenishRate,
          jutsuList: chakraTracker.jutsuList
        };
        const jsonData = JSON.stringify(data);
        const blob = new Blob([jsonData], {type: "text/plain;charset=utf-8"});
        const url = URL.createObjectURL(blob);

        const link = document.createElement("a");
        link.href = url;
        link.download = "Chakra.txt"; // Set the filename to "Chakra.txt"
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    }

    function loadData() {
      const file = fileInput.files; // Get the first file from the file list
      if (file) {
        if (file.name!== "Chakra.txt") {
          displayMessage("Invalid file name. Please select 'Chakra.txt'.", true);
          return;
        }

        const reader = new FileReader();
        reader.onload = function(event) {
          try {
            const data = JSON.parse(event.target.result);
            maxChakraInput.value = data.maxChakra;
            replenishRateInput.value = data.replenishRate;
            initializeTracker();
            chakraTracker.jutsuList = data.jutsuList;
            displayJutsuList();
          } catch (error) {
            displayMessage("Error loading data from file.", true);
          }
        };
        reader.readAsText(file);
      } else {
        displayMessage("No file selected.", true);
      }
    }

    function updateDisplay() {
      if (chakraTracker) {
        chakraTracker.replenish();
        document.getElementById("currentChakra").textContent = chakraTracker.currentChakra;
        document.getElementById("maxChakraDisplay").textContent = chakraTracker.maxChakra;
      }
    }

    // Function to add jutsu (called by the button)
    function addJutsu() {
      if (chakraTracker) {
        chakraTracker.addJutsu();
      }
    }

    // Initialize the tracker when the page loads
    initializeTracker();
    setInterval(updateDisplay, 1000);
  </script>
</body>
</html>
